{% extends 'base.html' %}
{% block content %}

<h2>Welcome, {{ user.first_name }}!</h2>

{% if teammates %}
<form method="POST" action="/submit_review_form" onsubmit="return confirmResubmission()">
  <div class="mb-3">
    <label class="form-label">Select Teammate to Review</label>
    <select class="form-select" name="reviewee_id" required>
      {% for teammate in teammates %}
      <option value="{{ teammate.id }}" {% if teammate.id in already_reviewed_ids %}data-reviewed="true" {% endif %}>
        {{ teammate.first_name }} {{ teammate.last_name }}
        {% if teammate.id in already_reviewed_ids %}(already rated){% endif %}
      </option>
      {% endfor %}
    </select>
  </div>

  {% for question in questions %}
  <div class="mb-3">
    <label class="form-label">{{ question.question_text }}</label>
    <select class="form-select" name="q_{{ question.id }}" required>
      {% for i in range(1, 11) %}
      <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
  </div>
  {% endfor %}

  <div class="mb-3">
    <label for="student_comment">Comment about this student:</label><br>
    <textarea name="student_comment" rows="3" cols="50" required></textarea>
  </div>

  <input type="hidden" name="class_id" value="{{ class_id }}">
  <input type="hidden" name="team_id" value="{{ team_id }}">
  <button type="submit" class="btn btn-primary">Submit Review</button>
</form>
{% else %}
<p>You are not assigned to any team in this class.</p>
{% endif %}

<a href="{{ url_for('logout') }}" class="btn btn-outline-danger mt-4">Logout</a>

<script>
  function confirmResubmission() {
    const selected = document.querySelector('select[name="reviewee_id"] option:checked');
    if (selected.dataset.reviewed === "true") {
      return confirm("You've already rated this student. Are you sure you want to rate them again?");
    }
    return true;
  }
</script>

{% endblock %}